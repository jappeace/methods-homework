include: person.2apl;

beliefs:
  clean( blockWorld ) :- not bomb(X,Y) , not carry(bomb).
  score(0).
  knowtrap( blockWorld ) :- trap(X, Y).
  sally(0, 0).

beliefupdates:
  { carry(bomb) }     Drop()   { not carry(bomb)}
  { not carry(bomb) and score(N) } PickUp() { carry(bomb), score(N + 1), not score(N)}
  { sally(X, Y)} locateSally(Z, Q) {not sally(X, Y), sally(Z, Q)}

plans:
  startup(0, 1, blue);

goals:
  clean( blockWorld ).
  followSally( blockWorld ).

pgrules:
  clean( blockWorld ) <- knowtrap(blockWorld) and bomb( X, Y ) and trap (Q, Z)|
  {
    goto( X, Y );
    @blockworld( pickup( ), _ );
		PickUp();
		-bomb( X, Y );
    goto(Q, Z);
		@blockworld( drop( ), _ );
		Drop();
  }
  followSally( blockWorld ) <- knowtrap(blockWorld) and not bomb( X, Y)|
  {
  }

pcrules:
  message( sally, inform, La, On, bombAt( X, Y ) ) <- true |
  {
    if B( not bomb( A, B ) ) {
      +bomb(X, Y);
      adoptz( clean( blockWorld ) );
    }
    else {
			+bomb( X, Y );
		}
  }
  message( sally, inform, La, On, trapAt( X, Y ) ) <- true |
  {
  	if B(not trap(A, B)){
		+trap(X, Y);
	}
  }
  message( sally, inform, La, On, sallyAt( X, Y ) ) <- true |
  {
  }

prrules:
  @blockworld( pickup(), _ ); REST; <- true |
  {
    @blockworld( sensePosition(), POS );
    B(POS = [X,Y]);
    -bomb(X, Y );
  }
